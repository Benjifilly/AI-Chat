<!DOCTYPE html>
<html lang="fr">
<head>    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Chat - Hugging Face</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="IA-chat.html.css">
    <style>        
    :root {
            /* Thème par défaut (clair) */
            --primary-color: #5E81AC;
            --primary-color-rgb: 94, 129, 172;
            --primary-color-light: rgba(94, 129, 172, 0.2);
            --primary-color-dark: #456891;
            --accent-color: #88C0D0;
            --accent-color-rgb: 136, 192, 208;
            --accent-hover: #97d3e3;
            
            /* Dimensions */
            --sidebar-width: 280px;
            --header-height: 64px;
            
            /* Couleurs de fond */
            --bg-color: #f8f9fa;
            --sidebar-bg: #2E3440;
            --sidebar-bg-hover: #3B4252;
            --main-bg: #ffffff;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            --user-msg-bg: #ebf0fa;
            --assistant-msg-bg: #f1f3f7;
            --system-msg-bg: #e5efff;
            --input-bg: #ffffff;
            --code-bg: #f0f2f4;
            --dropdown-bg: #ffffff;
            --dropdown-hover: #f5f7fa;
            
            /* Texte */
            --text-color: #333333;
            --text-secondary: #666666;
            --text-muted: #888888;
            --sidebar-text: #ECEFF4;
            --sidebar-text-muted: rgba(236, 239, 244, 0.7);
            --link-color: #5E81AC;
            --link-hover: #7aa1d2;
            
            /* Bordures et ombres */
            --border-color: #e0e0e0;
            --border-hover: #d0d0d0;
            --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            --box-shadow-hover: 0 4px 12px rgba(0,0,0,0.15);
              /* États de retour visuel */
            --success-color: #4caf50;
            --success-color-rgb: 76, 175, 80;
            --success-color-light: rgba(76, 175, 80, 0.15);
            --success-color-dark: #43a047;
            --warning-color: #ff9800;
            --warning-color-rgb: 255, 152, 0;
            --warning-color-light: rgba(255, 152, 0, 0.15);
            --warning-color-dark: #f57c00;
            --error-color: #f44336;
            --error-color-rgb: 244, 67, 54;
            --error-color-light: rgba(244, 67, 54, 0.15);
            --error-color-dark: #e53935;
            --info-color: #2196f3;
            --info-color-rgb: 33, 150, 243;
            --info-color-light: rgba(33, 150, 243, 0.15);
            --info-color-dark: #1e88e5;
              /* Éléments d'interface */
            --border-radius: 12px;
            --border-radius-sm: 6px;
            --modal-border-radius: 20px;
            --notification-shadow: 0 8px 20px rgba(0,0,0,0.2);
            --modal-shadow: 0 20px 40px rgba(0,0,0,0.3);
            --modal-backdrop: rgba(0,0,0,0.5);
            --modal-transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
            
            /* Effets de glassmorphisme */
            --blur-strength: 12px;
            --blur-strength-light: 6px;
            --glass-opacity: 0.7;
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            
            /* Élévation et hiérarchie visuelle */
            --elevation-1: 0 2px 5px rgba(0,0,0,0.08);
            --elevation-2: 0 4px 10px rgba(0,0,0,0.12);
            --elevation-3: 0 8px 20px rgba(0,0,0,0.15);
            --elevation-4: 0 16px 30px rgba(0,0,0,0.2);
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.45s ease;
        }
        
        body.theme-dark {
            --primary-color: #81A1C1;
            --primary-color-rgb: 129, 161, 193;
            --primary-color-light: rgba(129, 161, 193, 0.25);
            --primary-color-dark: #6D8AA6;
            
            /* Effets de glassmorphisme */
            --blur-strength: 10px;
            --blur-strength-light: 6px;
            --glass-opacity: 0.6;
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            
            /* Élévation et hiérarchie visuelle */
            --elevation-1: 0 2px 5px rgba(0,0,0,0.15);
            --elevation-2: 0 4px 10px rgba(0,0,0,0.2);
            --elevation-3: 0 8px 20px rgba(0,0,0,0.25);
            --elevation-4: 0 16px 30px rgba(0,0,0,0.3);
            --accent-color: #88C0D0;
            --accent-color-rgb: 136, 192, 208;
            --accent-hover: #97d3e3;
            
            /* Couleurs de fond */
            --bg-color: #2E3440;
            --sidebar-bg: #1d2128;
            --sidebar-bg-hover: #272d37;
            --main-bg: #3B4252;
            --header-bg: #2E3440;
            --card-bg: #434C5E;
            --user-msg-bg: #4C566A;
            --assistant-msg-bg: #3B4252;
            --system-msg-bg: #546075;
            --input-bg: #3B4252;
            --code-bg: #2E3440;
            --dropdown-bg: #3B4252;
            --dropdown-hover: #4C566A;
            
            /* Texte */
            --text-color: #E5E9F0;
            --text-secondary: #D8DEE9;
            --text-muted: #B7BCc5;
            --sidebar-text: #D8DEE9;
            --sidebar-text-muted: rgba(216, 222, 233, 0.7);
            --link-color: #88C0D0;
            --link-hover: #97d3e3;
            
            /* Bordures et ombres */
            --border-color: #4C566A;
            --border-hover: #5E6A82;
            --box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            --box-shadow-hover: 0 8px 16px rgba(0,0,0,0.4);
              /* États de retour visuel */
            --success-color: #A3BE8C;
            --success-color-rgb: 163, 190, 140;
            --success-color-light: rgba(163, 190, 140, 0.2);
            --success-color-dark: #94af7d;
            --warning-color: #EBCB8B;
            --warning-color-rgb: 235, 203, 139;
            --warning-color-light: rgba(235, 203, 139, 0.2);
            --warning-color-dark: #e5c078;
            --error-color: #BF616A;
            --error-color-rgb: 191, 97, 106;
            --error-color-light: rgba(191, 97, 106, 0.2);
            --error-color-dark: #b3545e;
            --info-color: #81A1C1;
            --info-color-rgb: 129, 161, 193;
            --info-color-light: rgba(129, 161, 193, 0.2);
            --info-color-dark: #7695b5;
        }
          body.theme-blue {
            --primary-color: #5E81AC;
            --primary-color-rgb: 94, 129, 172;
            --primary-color-light: rgba(94, 129, 172, 0.2);
            --primary-color-dark: #4F6E94;
            
            /* Effets de glassmorphisme */
            --blur-strength: 15px;
            --blur-strength-light: 8px;
            --glass-opacity: 0.75;
            --glass-border: 1px solid rgba(255, 255, 255, 0.25);
            
            /* Élévation et hiérarchie visuelle */
            --elevation-1: 0 2px 5px rgba(94, 129, 172, 0.1);
            --elevation-2: 0 4px 10px rgba(94, 129, 172, 0.15);
            --elevation-3: 0 8px 20px rgba(94, 129, 172, 0.2);
            --elevation-4: 0 16px 30px rgba(94, 129, 172, 0.25);
            --accent-color: #88C0D0;
            --accent-color-rgb: 136, 192, 208;
            --accent-hover: #97d3e3;
            
            /* Couleurs de fond */
            --bg-color: #ecf1f9;
            --sidebar-bg: #5E81AC;
            --sidebar-bg-hover: #5577a3;
            --main-bg: #ffffff;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            --user-msg-bg: #dbeaff;
            --assistant-msg-bg: #ecf3ff;
            --system-msg-bg: #c9e0ff;
            --input-bg: #ffffff;
            --code-bg: #edf2fa;
            --dropdown-bg: #ffffff;
            --dropdown-hover: #f5f9ff;
            
            /* Texte */
            --text-color: #2E3440;
            --text-secondary: #4C566A;
            --text-muted: #7B8DA6;
            --sidebar-text: #ECEFF4;
            --sidebar-text-muted: rgba(236, 239, 244, 0.8);
            --link-color: #5E81AC;
            --link-hover: #81A1C1;
            
            /* Bordures et ombres */
            --border-color: #d0deef;
            --border-hover: #b8cce3;
            --box-shadow: 0 2px 10px rgba(94, 129, 172, 0.15);
            --box-shadow-hover: 0 6px 16px rgba(94, 129, 172, 0.2);
              /* États de retour visuel */
            --success-color: #88C0D0;
            --success-color-rgb: 136, 192, 208;
            --success-color-light: rgba(136, 192, 208, 0.2);
            --success-color-dark: #79b7c9;
            --warning-color: #D08770;
            --warning-color-rgb: 208, 135, 112;
            --warning-color-light: rgba(208, 135, 112, 0.2);
            --warning-color-dark: #c77a60;
            --error-color: #BF616A;
            --error-color-rgb: 191, 97, 106;
            --error-color-light: rgba(191, 97, 106, 0.2);
            --error-color-dark: #b3545e;
            --info-color: #5E81AC;
            --info-color-rgb: 94, 129, 172;
            --info-color-light: rgba(94, 129, 172, 0.2);
            --info-color-dark: #4e71a0;
        }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            position: fixed;
            top: 0;
            left: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        .sidebar-collapsed {
            transform: translateX(-100%);
        }
        .main-content {
            margin-left: var(--sidebar-width);
            height: 100vh;
            transition: margin-left 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .main-content-expanded {
            margin-left: 0;
        }
        .header {
            height: var(--header-height);
            min-height: 60px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            background-color: var(--header-bg);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background-color: var(--main-bg);
        }
        .message-container {
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }        
        .message {
            padding: 16px 22px;
            margin-bottom: 24px;
            border-radius: var(--border-radius);
            animation: fadeIn 0.4s ease;
            word-wrap: break-word;
            box-shadow: var(--box-shadow);
            max-width: 85%;
            line-height: 1.6;
            position: relative;
            transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        box-shadow 0.25s ease,
                        opacity 0.25s ease;
        }        
        .message-user {
            background: linear-gradient(145deg, var(--user-msg-bg), color-mix(in srgb, var(--user-msg-bg) 90%, var(--primary-color)));
            align-self: flex-end;
            margin-left: auto;
            border-radius: 18px 18px 0 18px;
            border-top: 1px solid rgba(var(--primary-color-rgb), 0.15);
            border-left: 1px solid rgba(var(--primary-color-rgb), 0.15);
            color: var(--text-color);
        }
        .message-assistant {
            background: linear-gradient(145deg, var(--assistant-msg-bg), color-mix(in srgb, var(--assistant-msg-bg) 85%, white));
            border-left: 4px solid var(--primary-color);
            border-radius: 18px 18px 18px 0;
            margin-right: auto;
            color: var(--text-color);
        }        
        
        .message-system {
            background: linear-gradient(135deg, var(--system-msg-bg), color-mix(in srgb, var(--system-msg-bg) 90%, var(--primary-color-light)));
            border-left: 4px solid var(--primary-color);
            font-style: italic;
            margin-bottom: 30px;
            max-width: 100%;
            text-align: center;
            opacity: 0.95;
            animation: slideInDown 0.5s ease;
            color: var(--text-color);
            backdrop-filter: blur(var(--blur-strength-light));
            -webkit-backdrop-filter: blur(var(--blur-strength-light));
            box-shadow: var(--elevation-2);
        }
        .input-area {
            padding: 20px;
            background-color: var(--header-bg);
            border-top: 1px solid var(--border-color);
        }        
        .input-container {
            display: flex;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }
        .message-input {
            flex-grow: 1;
            padding: 12px 50px 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            resize: none;
            font-family: inherit;
            line-height: 1.5;
            transition: border-color 0.3s;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(var(--primary-color-rgb, 16, 163, 127), 0.2);
        }
        .send-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .send-button:hover {
            filter: brightness(1.1);
        }
        .send-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .sidebar-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        .new-chat-btn {
            width: 100%;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--sidebar-text);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .new-chat-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        .model-selector {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .model-dropdown {
            position: relative;
            margin-top: 10px;
        }
        .model-dropdown-btn {
            width: 100%;
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--sidebar-text);
            transition: background-color 0.3s;
        }
        .model-dropdown-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        .model-dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--dropdown-bg);
            min-width: 100%;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 6px;
            margin-top: 5px;
            overflow: hidden;
        }
        .model-dropdown-content.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .model-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }
        .model-option:hover {
            background-color: rgba(var(--primary-color-rgb, 16, 163, 127), 0.1);
        }        .model-option.active {
            background-color: rgba(var(--primary-color-rgb, 16, 163, 127), 0.2);
            border-left: 3px solid var(--primary-color);
            font-weight: bold;
        }
        
        /* Styles pour la liste des conversations */
        .conversations-section {
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 15px;
            padding-top: 15px;
        }
        
        .conversations-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .conversation-item {
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
        }
        
        .conversation-item:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
            border-color: rgba(var(--primary-color-rgb), 0.3);
        }
        
        .conversation-item.active {
            background-color: rgba(var(--primary-color-rgb), 0.2);
            border-color: var(--primary-color);
        }
        
        .conversation-title {
            font-size: 0.9em;
            font-weight: 500;
            color: var(--sidebar-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        
        .conversation-meta {
            font-size: 0.75em;
            color: rgba(var(--sidebar-text), 0.7);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .conversation-delete {
            background: none;
            border: none;
            color: rgba(var(--sidebar-text), 0.5);
            font-size: 0.8em;
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .conversation-item:hover .conversation-delete {
            opacity: 1;
        }
        
        .conversation-delete:hover {
            color: var(--error-color);
            background-color: rgba(255, 255, 255, 0.1);
        }        
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal-dialog {
            position: relative;
            margin: 5% auto;
            max-width: 500px;
            width: 90%;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .modal.show .modal-dialog {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
            backdrop-filter: blur(20px);
            color: var(--text-color);
        }

        .modal-header {
            padding: 24px 24px 16px 24px;
            border-bottom: 1px solid rgba(var(--border-color), 0.3);
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.05), rgba(var(--primary-color-rgb), 0.02));
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            text-align: center;
        }

        .btn-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(var(--text-color), 0.1);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .btn-close:hover {
            background: rgba(var(--error-color), 0.15);
            opacity: 1;
            transform: scale(1.1);
        }

        .btn-close::before {
            content: '×';
            font-size: 18px;
            color: var(--text-color);
            line-height: 1;
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: rgba(var(--primary-color-rgb), 0.05);
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: rgba(var(--primary-color-rgb), 0.3);
            border-radius: 10px;
        }

        .modal-footer {
            padding: 16px 24px 24px 24px;
            background: rgba(var(--primary-color-rgb), 0.02);
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Improved form controls in modals */
        .modal .form-label {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .modal .form-control, .modal .form-range {
            border-radius: 12px;
            border: 1px solid rgba(var(--border-color), 0.5);
            background-color: rgba(var(--input-bg), 0.8);
            color: var(--text-color);
            padding: 12px 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
            outline: none;
        }

        .modal .btn {
            border-radius: 12px;
            padding: 10px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            backdrop-filter: blur(10px);
        }

        .modal .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), rgba(var(--primary-color-rgb), 0.8));
            color: white;
        }

        .modal .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(var(--primary-color-rgb), 0.3);
        }

        .modal .btn-secondary {
            background: rgba(var(--text-color), 0.1);
            color: var(--text-color);
        }

        .modal .btn-secondary:hover {
            background: rgba(var(--text-color), 0.2);
            transform: translateY(-1px);
        }

        /* Theme selector improvements */
        .theme-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
            padding: 16px;
            background: rgba(var(--primary-color-rgb), 0.05);
            border-radius: 12px;
        }

        .theme-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .theme-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .theme-option.active {
            border-color: var(--primary-color);
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(var(--primary-color-rgb), 0.3);
        }

        .theme-option.active::before {
            opacity: 1;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .typing-indicator {
            padding: 10px 20px;
            background-color: var(--assistant-msg-bg);
            border-left: 4px solid var(--primary-color);
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s ease;
        }        
        .typing-dots span {
            display: inline-block;
            width: 10px;
            height: 8px;
            border-radius: 50%;
            background-color: white;
            margin: 0 3px;
            animation: bounce 1.4s infinite ease-in-out;
            opacity: 0.8;
        }
        .typing-dots span:nth-child(1) { animation-delay: 0s; }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
          /* Styles pour les blocs de code */
        pre {
            background-color: var(--code-bg);
            border-radius: 8px;
            padding: 16px;
            margin: 18px 0;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            position: relative;
        }
        pre::before {
            content: attr(data-language);
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 10px;
            font-size: 0.7em;
            font-weight: bold;
            color: var(--text-color);
            opacity: 0.7;
            background-color: rgba(var(--primary-color-rgb), 0.1);
            border-radius: 0 8px 0 8px;
            text-transform: uppercase;
        }
        code {
            font-family: 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            color: var(--text-color);
            background-color: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            letter-spacing: -0.3px;
        }
        pre code {
            padding: 0;
            background: none;
            line-height: 1.5;
        }
        
        /* Bouton de copie du code */
        .copy-btn {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background-color: rgba(var(--primary-color-rgb), 0.2);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
        }
        pre:hover .copy-btn {
            opacity: 0.7;
        }
        .copy-btn:hover {
            opacity: 1 !important;
            background-color: rgba(var(--primary-color-rgb), 0.4);
        }        /* Système de notifications en haut au milieu - style iOS */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            width: auto;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }        .notification {
            padding: 14px 18px;
            border-radius: 16px;
            margin-bottom: 10px;
            animation: notification-slide-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
            display: flex;
            align-items: center;
            box-shadow: var(--elevation-3);
            min-width: 240px;
            max-width: 450px;
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            pointer-events: all;
            position: relative;
            font-weight: 500;
            letter-spacing: 0.2px;
            line-height: 1.4;
            overflow: hidden;
            transform-origin: center top;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        box-shadow 0.2s ease,
                        opacity 0.3s ease;
        }
        
        .notification::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 1.5px; /* Épaisseur de la bordure */
            background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.2), transparent 50%);
            /* Résolution du problème de compatibilité des masques CSS */
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            mask-composite: exclude;
            pointer-events: none;
        }
        
        .notification i {
            margin-right: 12px;
            font-size: 20px;
        }
        
        .notification .notification-content {
            flex: 1;
        }
        
        .notification .notification-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .notification .notification-close {
            background: transparent;
            border: none;
            color: white;
            opacity: 0.7;
            cursor: pointer;
            padding: 0;
            margin-left: 10px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .notification .notification-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }.notification.success {
            background: linear-gradient(145deg, var(--success-color), var(--success-color-dark));
            box-shadow: 0 8px 20px rgba(var(--success-color-rgb), 0.25),
                        0 2px 6px rgba(var(--success-color-rgb), 0.2);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .notification.error {
            background: linear-gradient(145deg, var(--error-color), var(--error-color-dark));
            box-shadow: 0 8px 20px rgba(var(--error-color-rgb), 0.25),
                        0 2px 6px rgba(var(--error-color-rgb), 0.2);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .notification.warning {
            background: linear-gradient(145deg, var(--warning-color), var(--warning-color-dark));
            box-shadow: 0 8px 20px rgba(var(--warning-color-rgb), 0.25),
                        0 2px 6px rgba(var(--warning-color-rgb), 0.2);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .notification.info {
            background: linear-gradient(145deg, var(--info-color), var(--info-color-dark));
            box-shadow: 0 8px 20px rgba(var(--info-color-rgb), 0.25),
                        0 2px 6px rgba(var(--info-color-rgb), 0.2);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
          @keyframes notification-slide-in {
            0% {
                transform: translateY(-25px) scale(0.85);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        @keyframes notification-slide-out {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            30% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-25px) scale(0.85);
                opacity: 0;
            }
        }
        
        .notification.slide-out {
            animation: notification-slide-out 0.35s forwards cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        /* Ajouter un effet de pulsation à l'icône pour attirer l'attention */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        
        .notification i {
            animation: pulse 1.5s infinite ease-in-out;
        }
          /* Animation pour les indicateurs de typing */
        .typing-indicator {
            display: none;
            padding: 10px 14px;
            margin: 10px;
            border-radius: 12px;
            max-width: 60px;
            animation: fadeIn 0.3s ease;
        }

        .typing-dots {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Scrollbar personnalisée */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(var(--primary-color-rgb), 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(var(--primary-color-rgb), 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--primary-color-rgb), 0.5);
        }

        /* Table styling with enhanced visual design */
        .message table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            margin: 1rem 0 1.5rem;
            color: var(--text-color);
            font-size: 0.92em;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--elevation-1);
        }

        .message .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 1.2rem 0;
            border-radius: var(--border-radius-sm);
            background: rgba(var(--primary-color-rgb), 0.02);
        }

        .message table th,
        .message table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
            border: 1px solid var(--border-color);
            text-align: left;
            line-height: 1.4;
        }

        .message table thead th {
            vertical-align: bottom;
            background: linear-gradient(to bottom, 
                   rgba(var(--primary-color-rgb), 0.12),
                   rgba(var(--primary-color-rgb), 0.05));
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .message table tbody tr:nth-child(odd) {
            background-color: rgba(var(--primary-color-rgb), 0.03);
        }

        .message table tbody tr:hover {
            background-color: rgba(var(--primary-color-rgb), 0.08);
            transition: background-color var(--transition-fast);
        }
        
        .message table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .message table caption {
            padding: 0.75rem;
            caption-side: bottom;
            font-style: italic;
            color: var(--text-muted);
            text-align: center;
            border-top: 1px solid var(--border-color);
        }


        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar-expanded {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Container de notifications -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5 class="m-0">IA Chat</h5>
            <button class="btn btn-sm btn-dark" id="sidebar-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="p-3">
            <button class="new-chat-btn" id="new-chat-btn">
                <i class="fas fa-plus me-2"></i> Nouvelle conversation
            </button>
        </div>        <div class="model-selector">
            <h6 class="text-secondary mb-3">Modèles</h6>
            <div id="model-options">
                <!-- Model options will be populated by JS -->
            </div>
        </div>
        
        <!-- Section des conversations -->
        <div class="conversations-section">
            <h6 class="text-secondary mb-3 px-3">Conversations</h6>
            <div class="conversations-list px-3" id="conversations-list">
                <!-- Les conversations seront ajoutées ici -->
            </div>
        </div>
        
        <div class="p-3 mt-3">
            <button class="btn btn-outline-light btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#settingsModal">
                <i class="fas fa-cog me-2"></i> Paramètres
            </button>
            <button class="btn btn-outline-light btn-sm w-100" data-bs-toggle="modal" data-bs-target="#aboutModal">
                <i class="fas fa-info-circle me-2"></i> À propos
            </button>
        </div>
    </div>

    <!-- Main Content -->    
     <div class="main-content" id="main-content">
        <div class="header">
            <button class="menu-toggle me-3" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="d-flex align-items-center">
                <div class="connection-indicator disconnected" id="connection-status" title="Statut de connexion"></div>
                <h5 class="m-0">Conversation avec <span id="current-model">IA</span></h5>
            </div>
            <div class="ms-auto">
                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#parametersModal">
                    <i class="fas fa-sliders-h"></i>
                </button>
            </div>
        </div>
        
        <div class="chat-container" id="chat-container">
            <div class="message-container" id="message-container">
                <!-- Messages will appear here -->
                <div class="message message-system" id="welcome-message">
                    Bonjour ! Je suis votre assistant IA. Comment puis-je vous aider aujourd'hui ?
                </div>
            </div>
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <div class="input-container">
                <textarea 
                    class="message-input" 
                    id="message-input" 
                    placeholder="Écrivez votre message ici..." 
                    rows="1"></textarea>
                <button class="send-button" id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Paramètres</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>                <div class="modal-body">
                    <div class="mb-3">
                        <label for="api-key" class="form-label">Clé API</label>
                        <input type="password" class="form-control" id="api-key" value="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">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Thème</label>
                        <div class="theme-selector">
                            <div class="theme-option theme-light active" data-theme="light" title="Thème clair"></div>
                            <div class="theme-option theme-dark" data-theme="dark" title="Thème sombre"></div>
                            <div class="theme-option theme-blue" data-theme="blue" title="Thème bleu"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" id="save-settings">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Parameters Modal -->
    <div class="modal fade" id="parametersModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Paramètres de génération</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="temperature" class="form-label">Température: <span id="temperature-value">0.7</span></label>
                        <input type="range" class="form-range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                        <small class="text-muted">Contrôle la créativité des réponses (0 pour plus de précision, 1 pour plus de créativité)</small>
                    </div>
                    <div class="mb-3">
                        <label for="max-tokens" class="form-label">Longueur maximale: <span id="max-tokens-value">150</span></label>
                        <input type="range" class="form-range" id="max-tokens" min="50" max="500" step="10" value="150">
                        <small class="text-muted">Nombre maximum de tokens à générer</small>
                    </div>
                    <div class="mb-3">
                        <label for="system-message" class="form-label">Message système</label>
                        <textarea class="form-control" id="system-message" rows="3">Tu es un assistant utile et amical.</textarea>
                        <small class="text-muted">Définit le comportement de l'assistant</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" id="apply-parameters">Appliquer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">À propos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>                <div class="modal-body">
                    <h5><i class="fas fa-robot me-2"></i>IA Chat - Hugging Face</h5>
                    <p class="text-muted">Version 2.0 - Interface de chat intelligente</p>
                    
                    <p>Interface de chat moderne avec support de plusieurs modèles d'intelligence artificielle fournis par Hugging Face.</p>
                    
                    <h6 class="mt-4">✨ Fonctionnalités :</h6>
                    <ul class="small">
                        <li>🤖 Support de multiples modèles IA (Llama, Mistral, etc.)</li>
                        <li>💬 Conversations multiples avec sauvegarde automatique</li>
                        <li>🎨 Thèmes personnalisables (Clair, Sombre, Bleu)</li>
                        <li>📝 Support du Markdown et coloration syntaxique</li>
                        <li>🔧 Paramètres de génération configurables</li>
                        <li>📱 Interface responsive adaptée mobile</li>
                    </ul>
                    
                    <h6 class="mt-3">🔗 Powered by:</h6>
                    <p class="small text-muted">
                        • Hugging Face Inference API<br>
                        • Bootstrap 5 & Font Awesome<br>
                        • Highlight.js & Marked.js
                    </p>
                    
                    <div class="mt-4">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="exporterConversations()">
                            <i class="fas fa-download me-1"></i> Exporter conversations
                        </button>
                        <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importerConversations(event)">
                        <button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('import-file').click()">
                            <i class="fas fa-upload me-1"></i> Importer conversations
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>        // Configuration API Hugging Face
        // Récupération de la clé API depuis le localStorage ou utilisation de la clé par défaut
        let API_KEY = localStorage.getItem('hf_api_key') || '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'; // Clé API Hugging Face
        
        // Liste des modèles disponibles sur Hugging Face (modèles fiables et fonctionnels)
        const MODELES_DISPONIBLES = [
            'meta-llama/Llama-3.1-8B-Instruct',
            'mistralai/Mistral-7B-Instruct-v0.3',
        ];// Paramètres de génération
        let parametres = {
            temperature: 0.7,
            max_tokens: 150,
            system_message: 'Tu es un assistant utile et amical.'
        };

        // Gestion des conversations multiples
        let conversations = [];
        let conversationActive = null;
        let conversationIdCounter = 1;

        // Initialisation de l'historique de la conversation
        let historiqueMessages = [
            { role: 'system', content: parametres.system_message }
        ];

        let modeleChoisi = MODELES_DISPONIBLES[0];
        let isTyping = false;

        // Éléments DOM
        const messageContainer = document.getElementById('message-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const modelOptions = document.getElementById('model-options');
        const chatContainer = document.getElementById('chat-container');
        const currentModel = document.getElementById('current-model');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebarClose = document.getElementById('sidebar-close');
        const newChatBtn = document.getElementById('new-chat-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const conversationsList = document.getElementById('conversations-list');
        
        // Initialisation des éléments de paramètres
        const temperatureSlider = document.getElementById('temperature');
        const temperatureValue = document.getElementById('temperature-value');
        const maxTokensSlider = document.getElementById('max-tokens');
        const maxTokensValue = document.getElementById('max-tokens-value');
        const systemMessage = document.getElementById('system-message');
        const applyParameters = document.getElementById('apply-parameters');
        const apiKeyInput = document.getElementById('api-key');
        const saveSettings = document.getElementById('save-settings');        // Variables pour la gestion de la connexion
        let connectionStatus = 'disconnected'; // disconnected, connecting, connected
        const connectionIndicator = document.getElementById('connection-status');        // Initialisation de l'interface
        function initialiserInterface() {            // Créer le dropdown pour les modèles
            createModelDropdown();

            // Définir le modèle actuel
            const modelName = modeleChoisi.split('/')[1];
            currentModel.textContent = modelName;

            // Initialiser les conversations
            creerConversationParDefaut();

            // Initialiser le thème
            initTheme();

            // Vérifier l'état de l'API
            checkApiStatus();

            // Configurer les listeners d'événements
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    envoyerMessage();
                }
                // Permettre la création de nouvelles lignes avec Shift+Enter
                if (e.key === 'Enter' && e.shiftKey) {
                    messageInput.value += '\n';
                    ajusterHauteurInput();
                }
            });

            // Ajuster automatiquement la hauteur du textarea
            messageInput.addEventListener('input', ajusterHauteurInput);            // Ajouter des raccourcis clavier
            document.addEventListener('keydown', (e) => {
                // Ctrl+Enter ou Cmd+Enter pour envoyer un message
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && document.activeElement === messageInput) {
                    e.preventDefault();
                    envoyerMessage();
                }
                
                // Ctrl+N ou Cmd+N pour nouvelle conversation
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    nouvelleConversation();
                }
                
                // Ctrl+1-9 pour changer de conversation rapidement
                if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '9') {
                    e.preventDefault();
                    const index = parseInt(e.key) - 1;
                    if (conversations[index]) {
                        changerConversation(conversations[index].id);
                    }
                }
                
                // Échap pour annuler l'édition
                if (e.key === 'Escape' && document.activeElement === messageInput && messageInput.value !== '') {
                    e.preventDefault();
                    if (confirm('Voulez-vous effacer votre message actuel ?')) {
                        messageInput.value = '';
                        ajusterHauteurInput();
                    }
                }
            });

            // Event listeners pour les boutons
            sendButton.addEventListener('click', envoyerMessage);

            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('sidebar-expanded');
            });

            sidebarClose.addEventListener('click', () => {
                sidebar.classList.remove('sidebar-expanded');
            });

            newChatBtn.addEventListener('click', nouvelleConversation);

            // Paramètres avec prévisualisation en temps réel
            temperatureSlider.addEventListener('input', () => {
                const value = temperatureSlider.value;
                temperatureValue.textContent = value;
                // Mise à jour visuelle du style en fonction de la température
                const hue = 200 - (value * 100); // Plus chaud visuellement pour les températures élevées
                temperatureSlider.style.setProperty('--track-color', `hsl(${hue}, 80%, 60%)`);
            });

            maxTokensSlider.addEventListener('input', () => {
                const value = maxTokensSlider.value;
                maxTokensValue.textContent = value;
            });

            applyParameters.addEventListener('click', appliquerParametres);
            saveSettings.addEventListener('click', sauvegarderParametres);
            
            // Focus sur le champ de saisie
            messageInput.focus();
              // Message de bienvenue amélioré avec les raccourcis
            setTimeout(() => {
                const welcomeMsg = document.getElementById('welcome-message');
                if (welcomeMsg) {
                    welcomeMsg.classList.add('animate__animated', 'animate__fadeInUp');
                    welcomeMsg.innerHTML = `
                        <div class="welcome-header">
                            <h5><i class="fas fa-robot me-2"></i> Bienvenue sur IA Chat - Hugging Face</h5>
                        </div>
                        <p>Je suis votre assistant IA propulsé par Hugging Face. Comment puis-je vous aider aujourd'hui ?</p>
                        <div class="small text-muted">
                            <p><strong>💡 Raccourcis clavier :</strong></p>
                            <p>• <kbd>Ctrl</kbd> + <kbd>Enter</kbd> : Envoyer le message</p>
                            <p>• <kbd>Ctrl</kbd> + <kbd>N</kbd> : Nouvelle conversation</p>
                            <p>• <kbd>Ctrl</kbd> + <kbd>1-9</kbd> : Changer de conversation</p>
                            <p>• <kbd>Shift</kbd> + <kbd>Enter</kbd> : Nouvelle ligne</p>
                        </div>
                    `;
                }
            }, 300);
        }

        // Fonction pour changer de modèle
        function changerModele(modele) {
            modeleChoisi = modele;
            
            // Mettre à jour l'UI pour montrer le modèle actif
            document.querySelectorAll('.model-option').forEach(option => {
                if (option.getAttribute('data-model') === modele) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
            
            // Mettre à jour le nom du modèle dans le header
            const modelName = modele.split('/')[1].split(':')[0];
            currentModel.textContent = modelName;
            
            // Fermer le sidebar sur mobile
            sidebar.classList.remove('sidebar-expanded');
            
            // Ajouter une notification dans le chat
            showInfoNotification(`Modèle changé pour ${modelName}`);
        }

        // Fonction pour ajuster la hauteur du textarea
        function ajusterHauteurInput() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + 'px';
        }        // Fonction pour envoyer un message (utilisant la méthode du script Hugging.js)
        async function envoyerMessage() {
            const message = messageInput.value.trim();
            if (message === '' || isTyping) return;
            
            // Ajouter le message utilisateur à l'interface
            ajouterMessageUtilisateur(message);
            
            // Vider l'input et ajuster sa hauteur
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Désactiver le bouton d'envoi pendant la génération
            isTyping = true;
            sendButton.disabled = true;
            
            // Mettre à jour le statut de connexion
            updateConnectionStatus('connecting');
            
            // Afficher l'indicateur de chargement
            afficherIndicateurTyping();
            
            try {
                // Ajouter le message à l'historique
                historiqueMessages.push({ role: 'user', content: message });
                
                // Appel API avec gestion améliorée des erreurs
                const response = await fetch(`https://api-inference.huggingface.co/models/${modeleChoisi}/v1/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modeleChoisi,
                        messages: historiqueMessages,
                        temperature: parametres.temperature,
                        max_tokens: parametres.max_tokens
                    })
                });
                
                // Vérifier le statut HTTP
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    if (response.status === 401) {
                        // Problème d'authentification
                        updateConnectionStatus('error');
                        showErrorNotification("Erreur d'authentification: Clé API invalide");
                        setTimeout(() => {
                            openSettingsModal();
                        }, 2000);
                        throw new Error("Clé API invalide. Veuillez vérifier vos paramètres.");
                    } else if (response.status === 503) {
                        // Le modèle est en cours de chargement
                        updateConnectionStatus('connecting');
                        showInfoNotification("Le modèle est en cours de chargement, veuillez patienter...");
                        throw new Error('Le modèle est en cours de chargement, veuillez réessayer dans quelques instants');
                    } else {
                        updateConnectionStatus('error');
                        showErrorNotification(`Erreur API: ${errorData.error || response.status}`);
                        throw new Error(errorData.error || `Erreur HTTP: ${response.status}`);
                    }
                }
                
                const data = await response.json();
                
                // Récupérer la réponse (format chat completions Hugging Face)
                let assistantResponse = '';
                if (data.choices && data.choices.length > 0) {
                    assistantResponse = data.choices[0].message.content;
                } else {
                    throw new Error('Format de réponse inattendu');
                }
                
                // Masquer l'indicateur de chargement
                cacherIndicateurTyping();
                
                // Mettre à jour le statut de connexion
                updateConnectionStatus('connected');
                
                // Ajouter la réponse à l'historique et à l'interface
                historiqueMessages.push({ role: 'assistant', content: assistantResponse });
                ajouterMessageAssistant(assistantResponse);
                  // Mettre à jour la conversation active
                if (conversationActive) {
                    conversationActive.messages = [...historiqueMessages];
                    conversationActive.lastMessage = message.substring(0, 50) + (message.length > 50 ? '...' : '');
                    conversationActive.lastUpdate = new Date();
                    
                    // Générer un titre intelligent pour les nouvelles conversations
                    if (conversationActive.title.startsWith('Conversation') && historiqueMessages.length === 3) {
                        conversationActive.title = genererTitreConversation(message);
                    }
                    
                    mettreAJourListeConversations();
                    sauvegarderConversations();
                }
                
            } catch (error) {
                console.error('Erreur:', error);
                cacherIndicateurTyping();
                
                // Détecter le type d'erreur pour l'indicateur
                if (error.message && error.message.includes('chargement')) {
                    updateConnectionStatus('connecting');
                } else {
                    updateConnectionStatus('error');
                }
                
                ajouterMessageSysteme(`Erreur: ${error.message}`);
            } finally {
                // Réactiver le bouton d'envoi
                isTyping = false;
                sendButton.disabled = false;
            }
        }        
        // Fonctions de sauvegarde et chargement des conversations
        function sauvegarderConversations() {
            try {
                localStorage.setItem('conversations', JSON.stringify(conversations));
                localStorage.setItem('conversationActive', JSON.stringify(conversationActive?.id || null));
                localStorage.setItem('conversationIdCounter', conversationIdCounter.toString());
            } catch (error) {
                console.warn('Impossible de sauvegarder les conversations:', error);
            }
        }

        function chargerConversations() {
            try {
                const conversationsSauvegardees = localStorage.getItem('conversations');
                const activeId = localStorage.getItem('conversationActive');
                const counter = localStorage.getItem('conversationIdCounter');
                
                if (conversationsSauvegardees) {
                    conversations = JSON.parse(conversationsSauvegardees);
                    // Convertir les dates string en objets Date
                    conversations.forEach(conv => {
                        conv.lastUpdate = new Date(conv.lastUpdate);
                    });
                }
                
                if (counter) {
                    conversationIdCounter = parseInt(counter);
                }
                
                if (activeId && conversations.length > 0) {
                    const activeConv = conversations.find(c => c.id === parseInt(activeId));
                    if (activeConv) {
                        conversationActive = activeConv;
                        historiqueMessages = [...activeConv.messages];
                        
                        // Restaurer l'interface de chat
                        messageContainer.innerHTML = '';
                        activeConv.messages.forEach(msg => {
                            if (msg.role === 'user') {
                                ajouterMessageUtilisateur(msg.content);
                            } else if (msg.role === 'assistant') {
                                ajouterMessageAssistant(msg.content);
                            }
                        });
                    }
                }
                
                mettreAJourListeConversations();
            } catch (error) {
                console.warn('Impossible de charger les conversations:', error);
                creerConversationParDefaut();
            }
        }

        // Ajouter des améliorations à la fonction de création de titre intelligent
        function genererTitreConversation(premierMessage) {
            // Extraire les premiers mots significatifs
            const mots = premierMessage.split(' ').slice(0, 4);
            let titre = mots.join(' ');
            if (premierMessage.length > 30) {
                titre += '...';
            }
            
            // Capitaliser la première lettre
            titre = titre.charAt(0).toUpperCase() + titre.slice(1);
            
            return titre || 'Nouvelle conversation';
        }
          // Mise à jour du statut de connexion
        function updateConnectionStatus(status) {
            connectionStatus = status;
            connectionIndicator.className = `connection-indicator ${status}`;
            let title = '';
            switch(status) {
                case 'connected':
                    title = 'Connecté à Hugging Face';
                    break;
                case 'connecting':
                    title = 'Connexion en cours... Le modèle est en chargement';
                    break;
                case 'disconnected':
                    title = 'Déconnecté - Impossible de se connecter à l\'API';
                    break;
                case 'error':
                    title = 'Erreur de communication avec l\'API';
                    break;
            }
            connectionIndicator.setAttribute('title', title);
              // Afficher une notification dans l'UI pour les changements importants
            if (status === 'disconnected' || status === 'error') {
                // Au lieu d'utiliser un toast Bootstrap qui cause des erreurs,
                // utiliser notre système de notification personnalisé
                showErrorNotification(title);
            }
        }        // Vérifier l'état de l'API Hugging Face
        async function checkApiStatus() {
            try {
                updateConnectionStatus('connecting');
                
                const response = await fetch(`https://api-inference.huggingface.co/models/${modeleChoisi}/v1/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modeleChoisi,
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 5
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    if (response.status === 401) {
                        updateConnectionStatus('error');
                        showErrorNotification("Erreur d'authentification: Clé API invalide. Veuillez vérifier vos paramètres.");
                        // Suggestion de modification de la clé API
                        setTimeout(() => {
                            openSettingsModal();
                        }, 2000);
                        return;
                    } else if (response.status === 503) {
                        updateConnectionStatus('connecting');
                        showInfoNotification("Le modèle est en cours de chargement, veuillez patienter...");
                        setTimeout(checkApiStatus, 5000); // Réessayer après 5 secondes
                        return;
                    } else {
                        updateConnectionStatus('disconnected');
                        showErrorNotification(`Erreur API: ${errorData.error || response.status}`);
                        console.error('Erreur API:', errorData);
                        return;
                    }
                }
                
                updateConnectionStatus('connected');
                showSuccessNotification("Connexion établie avec succès");
            } catch (error) {
                console.error('Erreur de vérification API:', error);
                showErrorNotification("Erreur de connexion à l'API");
                updateConnectionStatus('disconnected');
            }
        }
        
        // Afficher l'indicateur de typing
        function afficherIndicateurTyping() {
            if (typingIndicator) {
                typingIndicator.style.display = 'block';
                messageContainer.appendChild(typingIndicator);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        function cacherIndicateurTyping() {
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
        }

        // Système de notifications
        function createNotification(message, type, duration = 5000) {
            const notifContainer = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = '';
            switch(type) {
                case 'success': icon = '<i class="fas fa-check-circle"></i>'; break;
                case 'error': icon = '<i class="fas fa-exclamation-circle"></i>'; break;
                case 'warning': icon = '<i class="fas fa-exclamation-triangle"></i>'; break;
                case 'info': icon = '<i class="fas fa-info-circle"></i>'; break;
            }
              notification.innerHTML = `${icon}<div class="notification-content">${message}</div><button class="notification-close" aria-label="Fermer"><i class="fas fa-times"></i></button>`;
            notifContainer.appendChild(notification);
            
            // Ajouter le gestionnaire d'événement pour le bouton de fermeture
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => removeNotification(notification));
            
            // Animation d'entrée est gérée par CSS
            
            // Supprimer après duration
            const timer = setTimeout(() => removeNotification(notification), duration);
            
            // Stocker le timer dans la notification pour pouvoir l'annuler si fermé manuellement
            notification._timer = timer;
            
            return notification;
        }
          function removeNotification(notification) {
            // Annuler le timer si fermeture manuelle
            if (notification._timer) {
                clearTimeout(notification._timer);
            }
            
            notification.classList.add('slide-out');
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 350); // Durée de l'animation de sortie (ajustée à la durée CSS)
        }
        
        function showSuccessNotification(message) {
            return createNotification(message, 'success');
        }
        
        function showErrorNotification(message) {
            return createNotification(message, 'error', 7000);
        }
        
        function showWarningNotification(message) {
            return createNotification(message, 'warning');
        }
        
        function showInfoNotification(message) {
            return createNotification(message, 'info');
        }

        // Modification de l'affichage des messages système
        function ajouterMessageSysteme(message) {
            showInfoNotification(message);
        }
        
        // Ajouter un message utilisateur à l'interface
        function ajouterMessageUtilisateur(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-user';
            messageDiv.textContent = message;
            messageContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }        // Ajouter un message de l'assistant à l'interface
        function ajouterMessageAssistant(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-assistant animate__animated animate__fadeIn';
            
            // Configuration des options de Marked (bibliothèque markdown)            // Créer un renderer personnalisé pour améliorer les tableaux
            const renderer = new marked.Renderer();
            
            // Amélioration du rendu des tableaux
            renderer.table = function(header, body) {
                return '<div class="table-responsive">\n'
                    + '<table class="table table-bordered table-hover">\n'
                    + '<thead>\n'
                    + header
                    + '</thead>\n'
                    + '<tbody>\n'
                    + body
                    + '</tbody>\n'
                    + '</table>\n'
                    + '</div>\n';
            };
            
            renderer.tablerow = function(content) {
                return '<tr>\n' + content + '</tr>\n';
            };
            
            renderer.tablecell = function(content, {header, align}) {
                const tag = header ? 'th' : 'td';
                const alignAttr = align ? ` align="${align}"` : '';
                return `<${tag}${alignAttr}>${content}</${tag}>\n`;
            };
            
            marked.setOptions({
                renderer: renderer,
                highlight: function(code, language) {
                    const validLanguage = hljs.getLanguage(language) ? language : 'plaintext';
                    return hljs.highlight(code, { language: validLanguage }).value;
                },
                langPrefix: 'hljs language-',
                pedantic: false,
                gfm: true,
                breaks: true,
                sanitize: false,
                smartypants: false,
                xhtml: false
            });
            
            // Vérification si le message n'est pas complet (coupé au milieu d'un bloc de code)
            let processedMessage = message;
            
            // Correction des problèmes de blocs de code incomplets
            const codeBlocksStart = (message.match(/```/g) || []).length;
            if (codeBlocksStart % 2 !== 0) {
                // Si le nombre de délimiteurs ``` est impair, ajouter un délimiteur de fermeture
                processedMessage = processedMessage + '\n```';
                // Ajouter une note indiquant que la réponse a été tronquée
                processedMessage = processedMessage + '\n\n*Note: La réponse a été tronquée.*';
            }
            
            // Correction des parenthèses/accolades/crochets non fermés
            const pairs = [
                { open: '(', close: ')', name: 'parenthèses' },
                { open: '{', close: '}', name: 'accolades' },
                { open: '[', close: ']', name: 'crochets' }
            ];
            
            let messageIncomplete = false;
            
            pairs.forEach(pair => {
                const openCount = (processedMessage.match(new RegExp('\\' + pair.open, 'g')) || []).length;
                const closeCount = (processedMessage.match(new RegExp('\\' + pair.close, 'g')) || []).length;
                
                if (openCount > closeCount) {
                    const diff = openCount - closeCount;
                    processedMessage += ' ' + pair.close.repeat(diff);
                    messageIncomplete = true;
                }
            });
            
            if (messageIncomplete) {
                processedMessage += '\n\n*Note: La structure du message a été corrigée pour un affichage correct.*';
            }
            
            // Utiliser marked pour parser le markdown
            let htmlMessage = marked.parse(processedMessage);
            
            // Ajouter des boutons de copie aux blocs de code
            htmlMessage = htmlMessage.replace(/<pre><code class="(.*?)">/, (match, language) => {
                const languageName = language.replace('hljs language-', '');
                return `<pre data-language="${languageName}"><code class="${language}"><button class="copy-btn" title="Copier le code"><i class="fas fa-copy"></i></button>`;
            });
            
            // Ajouter le contenu au message
            messageDiv.innerHTML = htmlMessage;
            messageContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Ajouter les event listeners aux boutons de copie
            messageDiv.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const codeBlock = e.target.closest('pre').querySelector('code');
                    const code = codeBlock.innerText;
                    
                    navigator.clipboard.writeText(code).then(() => {
                        // Changer brièvement l'icône pour indiquer que le code a été copié
                        const icon = e.target.tagName === 'I' ? e.target : e.target.querySelector('i');
                        const originalClass = icon.className;
                        icon.className = 'fas fa-check';
                        setTimeout(() => {
                            icon.className = originalClass;
                        }, 1500);
                    });
                });
            });
            
            // Appliquer highlight.js pour tout bloc de code qui n'aurait pas été capturé
            messageDiv.querySelectorAll('pre code').forEach((block) => {
                if (!block.classList.contains('hljs')) {
                    hljs.highlightElement(block);
                }
            });
        }
        
        // Fonction pour échapper les caractères HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }        // Ajouter un message système à l'interface
        function ajouterMessageSysteme(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-system';
            messageDiv.textContent = message;
            messageContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Système de notifications en haut
        function createNotification(message, type = 'info', duration = 5000) {
            const container = document.querySelector('.notification-container');
            if (!container) return;

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const iconMap = {
                success: '✓',
                error: '✕',
                warning: '⚠',
                info: 'ℹ'
            };

            notification.innerHTML = `
                <div class="d-flex">
                    <div class="notification-body">
                        <i class="fas ${iconMap[type]} me-2"></i> ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;

            container.appendChild(notification);

            // Animation d'entrée
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Auto-suppression
            if (duration > 0) {
                setTimeout(() => {
                    removeNotification(notification);
                }, duration);
            }

            return notification;
        }

        function removeNotification(notification) {
            notification.classList.remove('show');
            notification.classList.add('hide');
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.parentElement.removeChild(notification);
                }
            }, 300);
        }

        function showSuccessNotification(message) {
            createNotification(message, 'success', 4000);
        }

        function showErrorNotification(message) {
            createNotification(message, 'error', 6000);
        }

        function showWarningNotification(message) {
            createNotification(message, 'warning');
        }

        function showInfoNotification(message) {
            createNotification(message, 'info');
        }

        // Nouvelle conversation
        function nouvelleConversation() {
            // Créer une nouvelle conversation
            const nouvelleConv = {
                id: conversationIdCounter++,
                title: `Conversation ${conversationIdCounter - 1}`,
                messages: [{ role: 'system', content: parametres.system_message }],
                lastMessage: '',
                lastUpdate: new Date(),
                model: modeleChoisi
            };
            
            conversations.push(nouvelleConv);
            conversationActive = nouvelleConv;
            
            // Réinitialiser l'historique
            historiqueMessages = [
                { role: 'system', content: parametres.system_message }
            ];
            
            // Effacer l'interface de chat
            messageContainer.innerHTML = '';
            ajouterMessageSysteme('Nouvelle conversation démarrée. Comment puis-je vous aider ?');
              // Mettre à jour la liste des conversations
            mettreAJourListeConversations();
            sauvegarderConversations();
            
            // Fermer le sidebar sur mobile
            sidebar.classList.remove('sidebar-expanded');
        }        // Fonction pour créer une conversation par défaut
        function creerConversationParDefaut() {
            // Charger les conversations existantes d'abord
            chargerConversations();
            
            // Si aucune conversation n'existe, en créer une par défaut
            if (conversations.length === 0) {
                const convParDefaut = {
                    id: conversationIdCounter++,
                    title: 'Conversation initiale',
                    messages: [...historiqueMessages],
                    lastMessage: 'Conversation initiale',
                    lastUpdate: new Date(),
                    model: modeleChoisi
                };
                conversations.push(convParDefaut);
                conversationActive = convParDefaut;
                mettreAJourListeConversations();
                sauvegarderConversations();
            }
        }

        // Fonction pour changer de conversation
        function changerConversation(conversationId) {
            const conversation = conversations.find(c => c.id === conversationId);
            if (!conversation) return;
            
            conversationActive = conversation;
            historiqueMessages = [...conversation.messages];
            
            // Effacer et recharger l'interface de chat
            messageContainer.innerHTML = '';
            
            // Afficher tous les messages de la conversation
            conversation.messages.forEach(msg => {
                if (msg.role === 'user') {
                    ajouterMessageUtilisateur(msg.content);
                } else if (msg.role === 'assistant') {
                    ajouterMessageAssistant(msg.content);
                } else if (msg.role === 'system') {
                    // On peut ignorer le message système ou l'afficher
                }
            });
              // Mettre à jour l'interface
            mettreAJourListeConversations();
            sauvegarderConversations();
            
            // Fermer le sidebar sur mobile
            sidebar.classList.remove('sidebar-expanded');
        }

        // Fonction pour supprimer une conversation
        function supprimerConversation(conversationId) {
            if (conversations.length <= 1) {
                alert('Vous ne pouvez pas supprimer la dernière conversation.');
                return;
            }
            
            if (confirm('Êtes-vous sûr de vouloir supprimer cette conversation ?')) {
                const index = conversations.findIndex(c => c.id === conversationId);
                if (index !== -1) {
                    conversations.splice(index, 1);
                    
                    // Si c'était la conversation active, passer à une autre
                    if (conversationActive && conversationActive.id === conversationId) {
                        conversationActive = conversations[0];
                        changerConversation(conversationActive.id);                    } else {
                        mettreAJourListeConversations();
                        sauvegarderConversations();
                    }
                }
            }
        }

        // Fonction pour mettre à jour la liste des conversations
        function mettreAJourListeConversations() {
            conversationsList.innerHTML = '';
            
            conversations.forEach(conversation => {
                const conversationDiv = document.createElement('div');
                conversationDiv.className = `conversation-item ${conversation.id === conversationActive?.id ? 'active' : ''}`;
                
                const formatTime = (date) => {
                    const maintenant = new Date();
                    const diff = maintenant - date;
                    const minutes = Math.floor(diff / (1000 * 60));
                    const heures = Math.floor(diff / (1000 * 60 * 60));
                    const jours = Math.floor(diff / (1000 * 60 * 60 * 24));
                    
                    if (minutes < 60) return `${minutes}m`;
                    if (heures < 24) return `${heures}h`;
                    return `${jours}j`;
                };
                
                conversationDiv.innerHTML = `
                    <div class="conversation-title">${conversation.title}</div>
                    <div class="conversation-meta">
                        <span>${formatTime(conversation.lastUpdate)}</span>
                        <button class="conversation-delete" onclick="supprimerConversation(${conversation.id})" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                conversationDiv.addEventListener('click', (e) => {
                    if (!e.target.closest('.conversation-delete')) {
                        changerConversation(conversation.id);
                    }
                });
                
                conversationsList.appendChild(conversationDiv);
            });
        }
          // Création du dropdown des modèles
        function createModelDropdown() {
            modelOptions.innerHTML = `
                <div class="model-dropdown">
                    <button class="model-dropdown-btn">
                        <span><i class="fas fa-brain me-2"></i> <span id="dropdown-selected-model">Sélectionner un modèle</span></span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="model-dropdown-content" id="model-dropdown-content">
                        <!-- Les modèles seront ajoutés ici -->
                    </div>
                </div>
            `;            
            const dropdownContent = document.getElementById('model-dropdown-content');
            const dropdownBtn = document.querySelector('.model-dropdown-btn');
            const dropdownSelectedModel = document.getElementById('dropdown-selected-model');
            
            // Mettre à jour le texte du bouton avec le modèle sélectionné
            function updateDropdownButtonText() {
                const modelName = modeleChoisi.split('/')[1];
                dropdownSelectedModel.textContent = modelName;
            }
            
            // Initialiser avec le modèle actuel
            updateDropdownButtonText();
            
            // Ajouter les options de modèles avec des icônes distinctives
            MODELES_DISPONIBLES.forEach(modele => {
                const modeleParts = modele.split('/');
                const provider = modeleParts[0];
                const modeleName = modeleParts[1];
                
                // Déterminer l'icône selon le fournisseur

                let icon = 'fa-robot';
                if (provider === 'mistralai') icon = 'fa-wind';
                else if (provider === 'meta-llama') icon = 'fa-dragon';
                else if (provider === 'google') icon = 'fa-lightbulb';
                else if (provider === 'HuggingFaceH4') icon = 'fa-comments';
                else if (provider === 'microsoft') icon = 'fa-window';
                
                const option = document.createElement('div');
                option.className = `model-option ${modele === modeleChoisi ? 'active' : ''}`;
                option.setAttribute('data-model', modele);
                
                option.innerHTML = `
                    <div class="d-flex align-items-center w-100">
                        <div class="model-icon">
                            <i class="fas ${icon} me-2"></i>
                        </div>
                        <div class="model-info">
                            <div class="model-name">${modeleName}</div>
                            <small class="model-provider">${provider}</small>
                        </div>
                    </div>
                `;
                
                option.addEventListener('click', () => {
                    changerModele(modele);
                    document.querySelector('.model-dropdown-content').classList.remove('show');
                    updateDropdownButtonText();
                });
                dropdownContent.appendChild(option);
            });
            
            // Toggle dropdown
            dropdownBtn.addEventListener('click', () => {
                dropdownContent.classList.toggle('show');
            });
            
            // Fermer le dropdown si on clique ailleurs
            window.addEventListener('click', (e) => {
                if (!e.target.closest('.model-dropdown')) {
                    const dropdowns = document.getElementsByClassName('model-dropdown-content');
                    for (let i = 0; i < dropdowns.length; i++) {
                        if (dropdowns[i].classList.contains('show')) {
                            dropdowns[i].classList.remove('show');
                        }
                    }
                }
            });
        }
        
        // Initialisation du thème
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // Ajouter les event listeners pour les boutons de thème
            document.querySelectorAll('.theme-option').forEach(option => {
                const theme = option.getAttribute('data-theme');
                option.addEventListener('click', () => setTheme(theme));
                
                // Marquer l'option active
                if (theme === savedTheme) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }
        
        // Changement de thème
        function setTheme(theme) {
            document.body.className = theme ? `theme-${theme}` : '';
            localStorage.setItem('theme', theme);
            
            // Mettre à jour l'UI
            document.querySelectorAll('.theme-option').forEach(option => {
                if (option.getAttribute('data-theme') === theme) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }

        // Appliquer les paramètres
        function appliquerParametres() {
            parametres.temperature = parseFloat(temperatureSlider.value);
            parametres.max_tokens = parseInt(maxTokensSlider.value);
            parametres.system_message = systemMessage.value;
            
            // Mettre à jour le message système dans l'historique
            historiqueMessages[0] = { role: 'system', content: parametres.system_message };
            
            // Fermer le modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('parametersModal'));
            modal.hide();
                  // Notification
        showSuccessNotification('Paramètres de génération mis à jour');
    }

        // Initialiser les paramètres depuis le localStorage
        function initialiserParametres() {
            // Récupérer la clé API
            const savedApiKey = localStorage.getItem('hf_api_key');
            if (savedApiKey) {
                API_KEY = savedApiKey;
                apiKeyInput.value = savedApiKey;
            }
            
            // Récupérer les paramètres de génération
            const savedParams = localStorage.getItem('generationParams');
            if (savedParams) {
                try {
                    const params = JSON.parse(savedParams);
                    parametres = { ...parametres, ...params };
                    
                    // Mettre à jour l'UI
                    temperatureSlider.value = parametres.temperature;
                    temperatureValue.textContent = parametres.temperature;
                    
                    maxTokensSlider.value = parametres.max_tokens;
                    maxTokensValue.textContent = parametres.max_tokens;
                    
                    systemMessage.value = parametres.system_message;
                } catch (error) {
                    console.warn('Erreur lors du chargement des paramètres:', error);
                }
            }
        }

        // Sauvegarder les paramètres
        function sauvegarderParametres() {
            // Sauvegarder la clé API
            const newApiKey = apiKeyInput.value.trim();
            if (newApiKey && newApiKey !== API_KEY) {
                API_KEY = newApiKey;
                localStorage.setItem('hf_api_key', API_KEY);
                
                // Vérifier si la nouvelle clé fonctionne
                checkApiStatus();
            }
            
            // Fermer le modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('settingsModal'));
            modal.hide();
            
            // Notification
            showSuccessNotification('Paramètres sauvegardés');
        }

        // Fonctions d'export/import des conversations
        function exporterConversations() {
            const dataToExport = {
                conversations: conversations,
                metadata: {
                    exportDate: new Date().toISOString(),
                    version: '2.0',
                    totalConversations: conversations.length
                }
            };
            
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `conversations-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessNotification(`${conversations.length} conversations exportées avec succès`);
        }

        function importerConversations(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.conversations && Array.isArray(data.conversations)) {
                        // Confirmer l'import
                        const confirmer = confirm(`Importer ${data.conversations.length} conversations ? Cela remplacera vos conversations actuelles.`);
                        if (!confirmer) return;
                        
                        // Restaurer les conversations
                        conversations = data.conversations.map(conv => ({
                            ...conv,
                            lastUpdate: new Date(conv.lastUpdate)
                        }));
                        
                        // Réinitialiser l'ID counter
                        conversationIdCounter = Math.max(...conversations.map(c => c.id)) + 1;
                        
                        // Sélectionner la première conversation
                        if (conversations.length > 0) {
                            conversationActive = conversations[0];
                            changerConversation(conversationActive.id);
                        }
                        
                        sauvegarderConversations();
                        showSuccessNotification(`${conversations.length} conversations importées avec succès`);
                    } else {
                        throw new Error('Format de fichier invalide');
                    }
                } catch (error) {
                    alert('Erreur lors de l\'import : ' + error.message);
                }
            };            reader.readAsText(file);
            
            // Reset l'input file
            event.target.value = '';
        }

        // Fonction pour ouvrir le modal de paramètres
        function openSettingsModal() {
            // Mettre à jour la valeur affichée de la clé API
            apiKeyInput.value = API_KEY;
            
            const settingsModal = new bootstrap.Modal(document.getElementById('settingsModal'));
            settingsModal.show();
            
            // Mettre le focus sur l'input de la clé API
            setTimeout(() => {
                apiKeyInput.focus();
                apiKeyInput.select();
            }, 500);
        }

        // Initialiser l'interface au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            initialiserInterface();
            initialiserParametres();
        });
    </script>
</body>
</html>